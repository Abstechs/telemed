import{o as p,b as g,f as y,d as c}from"./app-Cv71cVJ1.js";import{onSnapshot as m,collection as u}from"https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";import"https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";const d=(t,e=!0)=>Toastify({text:t,duration:3e3,gravity:"top",position:"right",backgroundColor:e?"#16a34a":"#dc2626"}).showToast(),l=document.getElementById("hospitalForm"),i=document.getElementById("hospitalsList"),v=document.getElementById("logoutBtn");p(t=>{t||(window.location.href="/login.html")});v.addEventListener("click",async()=>{await g(),window.location.href="/login.html"});l.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("hName").value.trim(),o=document.getElementById("hLocation").value.trim(),n=document.getElementById("hEmail").value.trim();try{const s=await y.currentUser.getIdToken(),a=await fetch("../.netlify/functions/addHospital",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({name:e,location:o,contactEmail:n})}),h=await a.json();if(!a.ok)throw new Error(h.message||"Add failed");d("Hospital added"),l.reset()}catch(s){console.error(s),d(s.message,!1)}});m(u(c,"hospitals"),t=>{if(t.empty){i.innerHTML='<div class="text-gray-500">No hospitals</div>';return}i.innerHTML=t.docs.map(e=>{const o=e.data();return`<div class="p-2 border rounded mb-2"><div class="font-semibold">${o.name}</div><div class="text-xs text-gray-500">${o.location}</div><div class="text-xs">${o.contactEmail||""}</div></div>`}).join("")},t=>{i.innerHTML='<div class="text-red-500">Failed to load</div>',console.error(t)});const f=document.getElementById("adminChart").getContext("2d");let r=null;m(u(c,"cases"),t=>{const e={};t.docs.forEach(s=>{const a=s.data();e[a.disease]=(e[a.disease]||0)+1});const o=Object.keys(e),n=Object.values(e);r&&r.destroy(),r=new Chart(f,{type:"bar",data:{labels:o,datasets:[{label:"Cases",data:n,backgroundColor:"#059669"}]},options:{responsive:!0,plugins:{legend:{display:!1}}}})},t=>console.error(t));
